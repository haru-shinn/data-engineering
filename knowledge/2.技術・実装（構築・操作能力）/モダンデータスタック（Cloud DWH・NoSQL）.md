# モダンデータスタック

[[目次]]

## バルクインサートとは？

**列指向データベースの場合、１レコードずつインサートするよりバルクインサートのほうが効率が良いとは？**

例えば、｛名前、年齢、性別｝を保有している場合を考える。
行指向：[名前、年齢、性別]というセットをそのままディスクへ書き込む。
列指向：名前は名前の領域、年齢は年齢の領域へ保存する。

バルクインサートは、直でデータベース内部へデータを流し込んではいない。

- メモリ上でのバッファリング
  - メモリ上の「書き込み用バッファ」に行形式のまま一時的に保存する。
- 列単位への分割とソート
  - バッファがいっぱいになるか、一定時間が経過後、以下の処理を一括で行う。
    - メモリ内のデータを列単位に分解する。
    - 各列のデータを圧縮しやすくするためにソート、インデックスを作成する。
    - 列ごとにまとめられた大きなブロックとして、ディスクへ書き込む。
    - ※書き込み効率を上げるため、裏側で小さなファイル（Parts）をマージする仕組みが一般的。
