# 演習2：VACUUMの効果と肥大化（Bloat）の確認

**【重要度：7 / カテゴリ：S2.5 基本的な運用管理作業】**

PostgreSQL特有の「不要領域（ゴミ）」がどのように発生し、VACUUMでどう処理されるかを理解する演習です。

## シナリオ（VACCUM）

- **準備**: 大量のテストデータ（1万件程度）を持つテーブルを作成します。
  - `SELECT pg_relation_size('テーブル名');` で現在のサイズを確認します。
- **更新**: `UPDATE` 文ですべての行の値を書き換えます。
  - PostgreSQLは「古い行に削除フラグを立て、新しい行を追加」するため、この時点でデータ量は約2倍に増えています。
- **確認（不要領域）**: `pg_stat_user_tables` ビューを参照し、`n_dead_tup`（死んだタプル数）が増えていることを確認します。
- **実行（通常VACUUM）**: `VACUUM ANALYZE テーブル名;` を実行します。
  - 再度サイズを確認します。**サイズ自体は小さくならない**（再利用可能になるだけ）ことに注目してください。
- **実行（FULL）**: `VACUUM FULL テーブル名;` を実行します。
  - 再度サイズを確認します。OSに領域が返却され、ファイルサイズが劇的に小さくなるはずです。
