# メモ

達人に学ぶSQL徹底指南書を読む及び、写経、演習を通じて感じたことや考えたこと

下記について同じ命題を複数の書き方で書けることを学んだ。

- CASE式
- ウインドウ関数
- EXISTS (NOT EXISTS) 述語
- HAVING句 (CASE式含む) 集合論
- 外部結合、自己結合
- 数列

色々な書き方を学んだが、最終的には可読性やメンテナンス性を考慮する必要あり。
そして、現代は、CTEとウインドウ関数を利用することが多い。
その中で、従来のSQLの書き肩である自己結合や相関サブクエリといった、述語的記載や集合論を学ぶ意図としては、手続き型の思考を脱し、集合としてデータを捉える脳を鍛えるためである。
ウインドウ関数なども内部で行われているのは、集合の比較であったりするため、裏側のロジックを理解しておくと、CTEで分けるか分けないかの判断基準が自分の中に出来上がる。

整理（by gemeni）

- 基本（伝統的SQL）: 集合論や述語論理を理解し、どんな複雑な要件も「論理的」に解ける力をつける。
- 応用（現代的SQL）: CTE や ウィンドウ関数を使い、その論理を「読みやすく、保守しやすく」実装する。

|道具|脳内イメージ|こんな時に選ぶと「ベスト」|
|--|--|--|
|EXISTS|「門番・検品」|「条件に合わないものが一つでもあったら即アウト」という、厳格なチェックをしたいとき。|
|CASE|「ラベル貼り」|生のデータに「これは当たり、これはハズレ」と意味を与えて、加工したいとき。|
|HAVING|「合格発表」|グループ化した後、その「集団の平均や合計」を見て、集団ごとふるいにかけたいとき。|
|WINDOW関数|「横並びの比較」|「前後の行」や「自分を含めた範囲」など、行の枠を超えて周りを見渡したいとき。|
